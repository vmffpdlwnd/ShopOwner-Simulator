@page
@model IndexModel
@{
    ViewData["Title"] = "가게주인 시뮬레이터";
}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>가게주인 시뮬레이터</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 15px;
        }

        .header h1 {
            font-size: 2.5em;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            margin-bottom: 10px;
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: rgba(50, 50, 50, 0.8);
            border: 1px solid #ffd700;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
        }

        .stat-box .label {
            color: #aaa;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .stat-box .value {
            font-size: 1.5em;
            color: #ffd700;
            font-weight: bold;
        }

        .message-box {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .message-box.success {
            background: rgba(81, 207, 102, 0.2);
            border: 1px solid #51cf66;
            color: #51cf66;
            display: block;
        }

        .message-box.error {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            display: block;
        }

        .time-indicator {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .time-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #ffd700;
            background: rgba(50, 50, 50, 0.8);
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .time-btn:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: rgba(40, 40, 40, 0.9);
            border: 1px solid #666;
            border-radius: 5px;
            padding: 15px;
        }

        .panel h2 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 1px solid #666;
            padding-bottom: 10px;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .menu-btn {
            background: rgba(50, 50, 50, 0.8);
            border: 1px solid #666;
            color: #fff;
            padding: 12px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            text-align: left;
        }

        .menu-btn:hover {
            background: rgba(100, 100, 100, 0.8);
            border-color: #ffd700;
            color: #ffd700;
        }

        .menu-btn.active {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
            color: #ffd700;
        }

        .content-area {
            grid-column: 1 / -1;
            background: rgba(40, 40, 40, 0.9);
            border: 1px solid #666;
            border-radius: 5px;
            padding: 20px;
            min-height: 300px;
        }

        .content-area h3 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .item-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .item-card {
            background: rgba(60, 60, 60, 0.8);
            border: 1px solid #555;
            border-radius: 5px;
            padding: 12px;
            transition: all 0.3s;
        }

        .item-card:hover {
            border-color: #ffd700;
            background: rgba(80, 80, 80, 0.8);
        }

        .item-name {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .item-price {
            color: #aaa;
            font-size: 0.9em;
        }

        .action-btn {
            padding: 12px 20px;
            background: #ffd700;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
            width: 100%;
            margin-top: 15px;
        }

        .action-btn:hover {
            background: #ffed4e;
            transform: scale(1.02);
        }

        .info-text {
            color: #aaa;
            font-size: 0.9em;
            line-height: 1.6;
            margin: 10px 0;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        input[type="number"], input[type="radio"] {
            cursor: pointer;
        }

        .recipe-option {
            background: rgba(60, 60, 60, 0.8);
            border: 1px solid #555;
            border-radius: 5px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .recipe-option label {
            cursor: pointer;
            display: block;
        }

        .recipe-option strong {
            color: #ffd700;
        }

        @@media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .game-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏪 가게주인 시뮬레이터</h1>
            <p>자원을 모아 아이템을 제작하고 팔아 부자가 되자!</p>
        </div>

        <!-- 메시지 표시 -->
        @if (!string.IsNullOrEmpty(Model.Message))
        {
            <div class="message-box @Model.MessageType">
                @Model.Message
            </div>
        }

        <!-- 게임 상태 -->
        <div class="game-stats">
            <div class="stat-box">
                <div class="label">시간</div>
                <div class="value">아침 08:00</div>
            </div>
            <div class="stat-box">
                <div class="label">골드</div>
                <div class="value">@(Model.CurrentUser?.Gold.ToString("N0") ?? "0")G</div>
            </div>
            <div class="stat-box">
                <div class="label">레벨</div>
                <div class="value">@(Model.CurrentUser?.Level ?? 1)</div>
            </div>
        </div>

        <!-- 시간 선택 (비활성화 - 추후 구현) -->
        <div class="time-indicator">
            <button class="time-btn">☀️ 아침</button>
            <button class="time-btn">🌙 저녁</button>
        </div>

        <!-- 메인 콘텐츠 -->
        <div class="main-content">
            <!-- 왼쪽 패널: 상점 -->
            <div class="panel">
                <h2>🏪 상점</h2>
                <p class="info-text">NPC 상점에서 필요한 물품을 구매하세요.</p>
                <div class="menu-buttons">
                    <button class="menu-btn active" onclick="showSection('shop')">물품 구매</button>
                    <button class="menu-btn" onclick="showSection('myShop')">내 상점</button>
                </div>
            </div>

            <!-- 오른쪽 패널: 메뉴 -->
            <div class="panel">
                <h2>⚔️ 모험</h2>
                <p class="info-text">던전을 탐험하고 자원을 수집하세요.</p>
                <div class="menu-buttons">
                    <button class="menu-btn" onclick="showSection('dungeon')">던전 탐험</button>
                    <button class="menu-btn" onclick="showSection('inventory')">인벤토리</button>
                    <button class="menu-btn" onclick="showSection('crafting')">아이템 제작</button>
                    <button class="menu-btn" onclick="showSection('characters')">용병 관리</button>
                </div>
            </div>
        </div>

        <!-- 콘텐츠 영역 -->
        <div class="content-area">
            <!-- 상점 섹션 -->
            <div id="shop" class="content-section active">
                <h3>🏪 물품 구매</h3>
                <p class="info-text">상점 재고 변경: 내일 08:00</p>
                @if (Model.ShopItems?.Count > 0)
                {
                    <div class="item-list">
                        @foreach (var item in Model.ShopItems)
                        {
                            <div class="item-card">
                                <div class="item-name">@item.Name</div>
                                <div class="item-price">@item.Price.ToString("N0")G</div>
                            </div>
                        }
                    </div>
                    <form method="post">
                        <input type="hidden" name="Action" value="buy_shop" />
                        <div style="display: flex; gap: 10px;">
                            <input type="number" name="BuyQuantity" value="1" min="1" style="flex: 1; padding: 8px; background: rgba(50,50,50,0.8); border: 1px solid #666; color: #fff; border-radius: 5px;" />
                            <button type="submit" class="action-btn" style="flex: 1; margin-top: 0;">구매</button>
                        </div>
                    </form>
                }
                else
                {
                    <p class="info-text">상점이 준비 중입니다.</p>
                }
            </div>

            <!-- 내 상점 섹션 -->
            <div id="myShop" class="content-section">
                <h3>📊 내 상점 현황</h3>
                @if (Model.CurrentUser != null)
                {
                    <div class="info-text">
                        <p>총 골드: <span style="color: #ffd700;">@Model.CurrentUser.Gold.ToString("N0")G</span></p>
                        <p>보유 용병: <span style="color: #ffd700;">@(Model.CurrentUser.Characters?.Count ?? 0)명</span></p>
                        <p>보유 아이템: <span style="color: #ffd700;">@(Model.CurrentUser.Inventory?.Items?.Count ?? 0)개</span></p>
                    </div>
                }
            </div>

            <!-- 던전 탐험 섹션 -->
            <div id="dungeon" class="content-section">
                <h3>⚔️ 던전 탐험</h3>
                <p class="info-text">용병을 선택하고 던전을 탐험하세요.</p>
                @if (Model.AvailableDungeons?.Count > 0)
                {
                    <div class="item-list">
                        @foreach (var dungeon in Model.AvailableDungeons)
                        {
                            <div class="item-card">
                                <div class="item-name">@dungeon.Name</div>
                                <div class="item-price">난이도: @(string.Concat(Enumerable.Repeat("⭐", dungeon.Difficulty)))</div>
                            </div>
                        }
                    </div>
                    <form method="post">
                        <input type="hidden" name="Action" value="explore_dungeon" />
                        <button type="submit" class="action-btn">탐험 시작</button>
                    </form>

                    @if (Model.LastDungeonResult != null)
                    {
                        <hr style="border: none; border-top: 1px solid #666; margin: 15px 0;" />
                        <h4 style="color: #ffd700; margin-bottom: 10px;">⚔️ 탐험 결과</h4>
                        <div class="info-text">
                            <p>던전: @Model.LastDungeonResult.DungeonName</p>
                            <p>결과: @(Model.LastDungeonResult.Success ? "✓ 성공!" : "✗ 실패!")</p>
                            <p>목재 +@Model.LastDungeonResult.WoodGained, 철 +@Model.LastDungeonResult.IronGained</p>
                            <p>골드 +@Model.LastDungeonResult.GoldGained, 경험치 +@Model.LastDungeonResult.ExpGained</p>
                        </div>
                    }
                }
            </div>

            <!-- 인벤토리 섹션 -->
            <div id="inventory" class="content-section">
                <h3>🎒 인벤토리</h3>
                <p class="info-text">보유 자원 및 아이템</p>
                @if (Model.CurrentUser?.Inventory != null)
                {
                    <div class="info-text">
                        <p>목재: <span style="color: #ffd700;">@Model.CurrentUser.Inventory.Wood</span>개</p>
                        <p>철: <span style="color: #ffd700;">@Model.CurrentUser.Inventory.Iron</span>개</p>
                        <p>석재: <span style="color: #ffd700;">@Model.CurrentUser.Inventory.Stone</span>개</p>
                        <p>결정: <span style="color: #ffd700;">@Model.CurrentUser.Inventory.Crystal</span>개</p>
                        <hr style="border: none; border-top: 1px solid #666; margin: 15px 0;" />
                        <p>아이템 개수: <span style="color: #ffd700;">@(Model.CurrentUser.Inventory.Items?.Count ?? 0)개</span></p>
                        @if (Model.CurrentUser.Inventory.Items?.Count > 0)
                        {
                            @foreach (var item in Model.CurrentUser.Inventory.Items)
                            {
                                <p style="margin-left: 10px;">- @item.Name: @(item.Quantity)개</p>
                            }
                        }
                    </div>
                }
            </div>

            <!-- 아이템 제작 섹션 -->
            <div id="crafting" class="content-section">
                <h3>🔨 아이템 제작</h3>
                <p class="info-text">자원을 조합하여 아이템을 제작하세요.</p>
                @if (Model.AvailableRecipes?.Count > 0)
                {
                    <form method="post">
                        <input type="hidden" name="Action" value="craft_item" />
                        @foreach (var recipe in Model.AvailableRecipes)
                        {
                            <div class="recipe-option">
                                <label>
                                    <input type="radio" name="SelectedRecipeId" value="@recipe.RecipeId" style="margin-right: 8px;" />
                                    <strong>@recipe.ResultName</strong>
                                    <div style="color: #aaa; font-size: 0.9em; margin-top: 5px;">
                                        필요: 목재 @recipe.RequiredWood + 철 @recipe.RequiredIron + 석재 @recipe.RequiredStone
                                    </div>
                                    <div style="color: #ffd700; font-size: 0.9em; margin-top: 5px;">
                                        판매가: @recipe.SellPrice.ToString("N0")G
                                    </div>
                                </label>
                            </div>
                        }
                        <button type="submit" class="action-btn">제작하기</button>
                    </form>
                }
            </div>

            <!-- 용병 관리 섹션 -->
            <div id="characters" class="content-section">
                <h3>⚔️ 용병 관리</h3>
                <p class="info-text">보유한 용병들입니다.</p>
                @if (Model.AvailableCharacters?.Count > 0)
                {
                    <div class="item-list">
                        @foreach (var character in Model.AvailableCharacters)
                        {
                            <div class="item-card">
                                <div class="item-name">@character.Name</div>
                                <div class="item-price">
                                    Lv @character.Level | @character.Job
                                </div>
                                <div class="item-price" style="margin-top: 5px;">
                                    ATK: @character.Attack | DEF: @character.Defense
                                </div>
                            </div>
                        }
                    </div>
                    <form method="post">
                        <input type="hidden" name="Action" value="hire_character" />
                        <button type="submit" class="action-btn">새 용병 고용</button>
                    </form>
                }
            </div>
        </div>
    </div>

    <script>
        function showSection(sectionName) {
            // 모든 섹션 숨기기
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // 선택한 섹션 보이기
            const section = document.getElementById(sectionName);
            if (section) {
                section.classList.add('active');
            }

            // 메뉴 버튼 스타일 업데이트
            document.querySelectorAll('.menu-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
    </script>
</body>
</html>