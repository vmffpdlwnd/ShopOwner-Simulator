<!-- App.razor -->
@implements IAsyncDisposable
@inject NavigationManager Navigation
@inject GameState GameState

<Router AppAssembly="typeof(Program).Assembly" AdditionalAssemblies="new[] { typeof(App).Assembly }">
    <Found Context="routeData">
        <RouteView RouteData="routeData" DefaultLayout="typeof(MainLayout)" />
        <FocusOnNavigate RouteData="routeData" Selector="h1" />
    </Found>
    <NotFound>
        <PageTitle>Not found</PageTitle>
        <LayoutView Layout="typeof(MainLayout)">
            <div class="not-found">
                <h1>404 - Page Not Found</h1>
                <p>The page you're looking for doesn't exist.</p>
                <a href="/">Go back to home</a>
            </div>
        </LayoutView>
    </NotFound>
</Router>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">Ã—</a>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        // If the user hasn't initialized the game state yet (i.e. hasn't logged in
        // or started a guest session), send them to the login page so they can
        // choose between account or guest play. Initialization will run after
        // they choose.
        try
        {
            if (!GameState.IsInitialized)
            {
                Navigation.NavigateTo("/login");
            }
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"Error checking game state: {ex.Message}");
        }
    }

    async ValueTask IAsyncDisposable.DisposeAsync()
    {
        // Cleanup if needed
    }
}